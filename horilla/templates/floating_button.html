{% load static %}
{% load horillafilters %}
<style>
    .round {
        border-radius: 50%;
    }

    .fab {
        transition: all 300ms ease-in-out;
        width: 56px;
        height: 56px;
        background-color: #ff3b38;
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        left: 20px;
        bottom: 35px;
        user-select: none;
        cursor: pointer;
        color: white;
        font-size: 2em;
        box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.16),
            0px 3px 10px rgba(0, 0, 0, 0.16);
        z-index: 9999;
    }

    .fab i {
        transition: all 300ms ease-in-out;
        will-change: transform;
    }

    .inner-fabs .fab {
        width: 40px;
        height: 40px;
        left: 10px;
        bottom: 40px;
        font-size: 1.5em;
        will-change: bottom;
    }

    .inner-fabs.show .fab:nth-child(1) {
        bottom: 100px;
    }

    .inner-fabs.show .fab:nth-child(2) {
        bottom: 150px;
    }

    .inner-fabs.show .fab:nth-child(3) {
        bottom: 200px;
    }

    .inner-fabs.show .fab:nth-child(4) {
        bottom: 250px;
    }

    .inner-fabs.show .fab:nth-child(5) {
        bottom: 300px;
    }

    .inner-fabs.show .fab:nth-child(6) {
        bottom: 350px;
    }

    .inner-fabs.show .fab:nth-child(7) {
        bottom: 400px;
    }

    .inner-fabs.show .fab:nth-child(8) {
        bottom: 450px;
    }

    .inner-fabs.show + .fab i {
        transform: rotate(135deg);
    }

    .fab:before {
        content: attr(data-tooltip);
        transition: opacity 150ms cubic-bezier(0.4, 0, 1, 1);
        position: absolute;
        visibility: hidden;
        opacity: 0;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
        color: #ececec;
        left: 65px;
        top: 25%;
        background-color: rgba(70, 70, 70, 0.9);
        font-size: 0.5em;
        line-height: 1em;
        display: inline-block;
        text-align: center;
        white-space: nowrap;
        border-radius: 2px;
        padding: 6px 8px;
        max-width: 200px;
        font-weight: bold;
        text-overflow: ellipsis;
        vertical-align: middle;
    }

    .fab:hover:before {
        content: attr(data-tooltip);
        visibility: visible;
        opacity: 1;
    }
    .inner-fabs a {
        display: block;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .fab {
            left: 15px;
            width: 50px;
            height: 50px;
            font-size: 1.8em;
        }
        
        .inner-fabs .fab {
            left: 8px;
            width: 36px;
            height: 36px;
            font-size: 1.3em;
        }
        
        .fab:before {
            left: 55px;
            font-size: 0.45em;
            max-width: 150px;
        }
    }

    @media (max-width: 480px) {
        .fab {
            left: 12px;
            width: 48px;
            height: 48px;
        }
        
        .inner-fabs .fab {
            left: 6px;
            width: 34px;
            height: 34px;
        }
        
        .fab:before {
             left: 50px;
         }
     }

     /* Extra small screens */
     @media (max-width: 360px) {
         .fab {
             left: 10px;
             width: 44px;
             height: 44px;
             font-size: 1.6em;
         }
         
         .inner-fabs .fab {
             left: 5px;
             width: 32px;
             height: 32px;
             font-size: 1.2em;
         }
     }

     /* Hide/Show functionality */
     .fab-container.hidden {
         display: none !important;
     }

     .fab-toggle {
         position: fixed;
         left: 20px;
         top: 20px;
         width: 30px;
         height: 30px;
         background-color: #666;
         color: white;
         border: none;
         border-radius: 50%;
         cursor: pointer;
         font-size: 12px;
         z-index: 10000;
         display: flex;
         align-items: center;
         justify-content: center;
         transition: all 300ms ease-in-out;
     }

     .fab-toggle:hover {
         background-color: #333;
     }

     @media (max-width: 768px) {
         .fab-toggle {
             left: 15px;
             top: 15px;
         }
     }
 </style>

<!-- Toggle button to hide/show quick action menu -->
<button class="fab-toggle" id="fabToggle" title="Toggle Quick Actions">
    <i class="material-icons" style="font-size: 14px;">visibility</i>
</button>

<div class="fab-container" id="fabContainer">
<div class="inner-fabs">
    <div id="fab9" class="fab round" data-tooltip="Dashboard Charts">
        <a
            class="text-light"
            data-toggle="oh-modal-toggle"
            data-target="#objectDetailsModal"
            hx-get="{% url 'employee-chart-show' %}"
            hx-target="#objectDetailsModalTarget"
        >
            <i class="material-icons mt-2">leaderboard</i>
        </a>
    </div>
    {% if "helpdesk"|app_installed %}
        <div id="fab8" class="fab round" data-tooltip="Create Ticket">
            <a
                class="text-light"
                data-toggle="oh-modal-toggle"
                data-target="#objectCreateModal"
                hx-get="{% url 'ticket-create' %}"
                hx-target="#objectCreateModalTarget"
                >
                <i class="material-icons mt-2">sell</i>
            </a>
        </div>
    {% endif %}
    {% if "asset"|app_installed %}
    <div id="fab7" class="fab round" data-tooltip="Create Asset Request">
        <a
            class="text-light"
            data-toggle="oh-modal-toggle"
            data-target="#objectCreateModal"
            hx-get="{% url 'asset-request-creation' %}"
            hx-target="#objectCreateModalTarget"
        >
            <i class="material-icons mt-2">devices</i>
        </a>
    </div>
    {% endif %}
    {% if "payroll"|app_installed %}
    <div id="fab6" class="fab round" data-tooltip="Create Reimbursement">
        <a
            class="text-light"
            data-toggle="oh-modal-toggle"
            data-target="#objectCreateModal"
            hx-get="{% url 'create-reimbursement' %}"
            hx-target="#objectCreateModalTarget"
        >
            <i class="material-icons mt-2">paid</i>
        </a>
    </div>
    {% endif %}
    <div id="fab5" class="fab round" data-tooltip="Create Work Type Request">
        <a
            class="text-light"
            data-toggle="oh-modal-toggle"
            data-target="#objectCreateModal"
            hx-get="{% url 'work-type-request' %}"
            hx-target="#objectCreateModalTarget"
        >
            <i class="material-icons mt-2">work</i>
        </a>
    </div>
    <div id="fab4" class="fab round" data-tooltip="Create Shift Request">
        <a
            class="text-light"
            data-toggle="oh-modal-toggle"
            data-target="#objectCreateModal"
            hx-get="{% url 'shift-request' %}?emp_id={{request.user.employee_get.id}}"
            hx-target="#objectCreateModalTarget"
        >
            <i class="material-icons mt-2">history</i>
        </a>
    </div>
    {% if "leave"|app_installed %}
        <div id="fab3" class="fab round" data-tooltip="Create Leave Request">
            <a
                class="text-light"
                data-toggle="oh-modal-toggle"
                data-target="#objectCreateModal"
                {% if perms.leave.create_leaverequest %}
                    hx-get="{% url 'request-creation' %}"
                {% else %}
                    hx-get="{% url 'leave-request-create' %}"
                {% endif %}
                hx-target="#objectCreateModalTarget"
            >
                <span class="material-symbols-outlined mt-2">
                calendar_add_on
                </span>
            </a>
        </div>
    {% endif %}
    {% if "attendance"|app_installed %}
    <div id="fab2" class="fab round" data-tooltip="Create Attendance Request">
        <a
            class="text-light"
            data-toggle="oh-modal-toggle"
            data-target="#objectCreateModal"
            hx-get="{% url 'request-new-attendance' %}"
            hx-target="#objectCreateModalTarget"
        >
            <span class="material-symbols-outlined mt-2">
                person_add
            </span>
        </a>
    </div>
    {% endif %}
</div>
<div id="fab1" class="fab round" data-tooltip="Quick Action">
    <i id="fabIcon" class="material-icons">add</i>
</div>
</div>

<script>
    $(document).ready(function () {
        let fab1 = $("#fab1");
        let innerFabs = $(".inner-fabs");
        let fabContainer = $("#fabContainer");
        let fabToggle = $("#fabToggle");
        let fabToggleIcon = fabToggle.find("i");

        // Load saved state from localStorage
        let isHidden = localStorage.getItem('quickActionHidden') === 'true';
        if (isHidden) {
            fabContainer.addClass('hidden');
            fabToggleIcon.text('visibility_off');
        }

        // Toggle visibility of quick action menu
        fabToggle.on("click", function () {
            fabContainer.toggleClass('hidden');
            let isNowHidden = fabContainer.hasClass('hidden');
            
            // Update icon
            fabToggleIcon.text(isNowHidden ? 'visibility_off' : 'visibility');
            
            // Save state to localStorage
            localStorage.setItem('quickActionHidden', isNowHidden);
            
            // Close inner fabs if hiding
            if (isNowHidden) {
                innerFabs.removeClass("show");
            }
        });

        fab1.on("click", function () {
            innerFabs.toggleClass("show");
        });

        $(document).on("click", function (e) {
            let targetId = $(e.target);
            let allowedIds = [
                "fab1",
                "fab2",
                "fab3",
                "fab4",
                "fab5",
                "fab6",
                "fab7",
                "fab8",
                "fab9",
                "fabIcon",
                "fabToggle"
            ];
            let isCloseButton =
                targetId.hasClass("oh-modal__close") ||
                targetId.hasClass("oh-modal__close--custom");

            if (
                !(
                    allowedIds.includes(targetId.closest(".fab").attr("id")) ||
                    allowedIds.includes(targetId.attr("id")) ||
                    isCloseButton
                )
            ) {
                innerFabs.removeClass("show");
            }
        });
    });
</script>
